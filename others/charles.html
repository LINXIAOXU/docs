<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Charles 抓包 | 个人文档</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="">
    <link rel="preload" href="/qa-docs/assets/css/0.styles.30c23280.css" as="style"><link rel="preload" href="/qa-docs/assets/js/app.b6b34311.js" as="script"><link rel="preload" href="/qa-docs/assets/js/3.d8df636e.js" as="script"><link rel="preload" href="/qa-docs/assets/js/4.7d1b1b70.js" as="script"><link rel="prefetch" href="/qa-docs/assets/js/10.9c349b89.js"><link rel="prefetch" href="/qa-docs/assets/js/11.a8aeaff6.js"><link rel="prefetch" href="/qa-docs/assets/js/12.741e948f.js"><link rel="prefetch" href="/qa-docs/assets/js/13.ff627ee2.js"><link rel="prefetch" href="/qa-docs/assets/js/14.56df8021.js"><link rel="prefetch" href="/qa-docs/assets/js/15.fd59d6a2.js"><link rel="prefetch" href="/qa-docs/assets/js/16.4d734805.js"><link rel="prefetch" href="/qa-docs/assets/js/17.d6f98694.js"><link rel="prefetch" href="/qa-docs/assets/js/18.5d623092.js"><link rel="prefetch" href="/qa-docs/assets/js/19.1ef1693b.js"><link rel="prefetch" href="/qa-docs/assets/js/2.cc1ee76d.js"><link rel="prefetch" href="/qa-docs/assets/js/20.17e6bc00.js"><link rel="prefetch" href="/qa-docs/assets/js/21.2da93537.js"><link rel="prefetch" href="/qa-docs/assets/js/22.c915c9e1.js"><link rel="prefetch" href="/qa-docs/assets/js/23.46a6636c.js"><link rel="prefetch" href="/qa-docs/assets/js/24.1d117ca5.js"><link rel="prefetch" href="/qa-docs/assets/js/25.36be0af2.js"><link rel="prefetch" href="/qa-docs/assets/js/26.0bb71420.js"><link rel="prefetch" href="/qa-docs/assets/js/27.c7744104.js"><link rel="prefetch" href="/qa-docs/assets/js/28.6cb445d2.js"><link rel="prefetch" href="/qa-docs/assets/js/29.e836fc08.js"><link rel="prefetch" href="/qa-docs/assets/js/30.f54bb6ea.js"><link rel="prefetch" href="/qa-docs/assets/js/31.ccbfd933.js"><link rel="prefetch" href="/qa-docs/assets/js/32.07150977.js"><link rel="prefetch" href="/qa-docs/assets/js/33.894629ea.js"><link rel="prefetch" href="/qa-docs/assets/js/34.5fb00fee.js"><link rel="prefetch" href="/qa-docs/assets/js/35.46dd1deb.js"><link rel="prefetch" href="/qa-docs/assets/js/36.2a7ef759.js"><link rel="prefetch" href="/qa-docs/assets/js/37.a7703132.js"><link rel="prefetch" href="/qa-docs/assets/js/38.184f2f7b.js"><link rel="prefetch" href="/qa-docs/assets/js/39.510847d6.js"><link rel="prefetch" href="/qa-docs/assets/js/40.7de47fbd.js"><link rel="prefetch" href="/qa-docs/assets/js/41.b81fdd2f.js"><link rel="prefetch" href="/qa-docs/assets/js/42.b040d113.js"><link rel="prefetch" href="/qa-docs/assets/js/43.be1ad23f.js"><link rel="prefetch" href="/qa-docs/assets/js/44.75ebac87.js"><link rel="prefetch" href="/qa-docs/assets/js/45.31f7e820.js"><link rel="prefetch" href="/qa-docs/assets/js/46.f732f4e5.js"><link rel="prefetch" href="/qa-docs/assets/js/5.6e29385f.js"><link rel="prefetch" href="/qa-docs/assets/js/6.53acc426.js"><link rel="prefetch" href="/qa-docs/assets/js/7.8e3635d6.js"><link rel="prefetch" href="/qa-docs/assets/js/8.383fddd5.js"><link rel="prefetch" href="/qa-docs/assets/js/9.abf996f7.js">
    <link rel="stylesheet" href="/qa-docs/assets/css/0.styles.30c23280.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/qa-docs/" class="home-link router-link-active"><!----> <span class="site-name">个人文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分类" class="dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/qa-docs/others/vuepress.html" class="nav-link">
  零碎知识
</a></li><li class="dropdown-item"><!----> <a href="/qa-docs/base/test-definition.html" class="nav-link">
  测试基础
</a></li><li class="dropdown-item"><!----> <a href="/qa-docs/code/mocha.html" class="nav-link">
  代码学习
</a></li><li class="dropdown-item"><!----> <a href="/qa-docs/linux/other.html" class="nav-link">
  Linux学习
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分类" class="dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/qa-docs/others/vuepress.html" class="nav-link">
  零碎知识
</a></li><li class="dropdown-item"><!----> <a href="/qa-docs/base/test-definition.html" class="nav-link">
  测试基础
</a></li><li class="dropdown-item"><!----> <a href="/qa-docs/code/mocha.html" class="nav-link">
  代码学习
</a></li><li class="dropdown-item"><!----> <a href="/qa-docs/linux/other.html" class="nav-link">
  Linux学习
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>零碎知识</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/qa-docs/others/vuepress.html" class="sidebar-link">部署vuepress项目</a></li><li><a href="/qa-docs/others/git.html" class="sidebar-link">git 相关知识</a></li><li><a href="/qa-docs/others/redis.html" class="sidebar-link">Redis入门</a></li><li><a href="/qa-docs/others/charles.html" aria-current="page" class="active sidebar-link">Charles 抓包</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/qa-docs/others/charles.html#简介" class="sidebar-link">简介</a></li><li class="sidebar-sub-header"><a href="/qa-docs/others/charles.html#mscos下载安装-charles" class="sidebar-link">mscOS下载安装 Charles</a></li><li class="sidebar-sub-header"><a href="/qa-docs/others/charles.html#http代理设置" class="sidebar-link">HTTP代理设置</a></li><li class="sidebar-sub-header"><a href="/qa-docs/others/charles.html#https代理配置" class="sidebar-link">HTTPS代理配置</a></li><li class="sidebar-sub-header"><a href="/qa-docs/others/charles.html#ios使用步骤" class="sidebar-link">iOS使用步骤</a></li><li class="sidebar-sub-header"><a href="/qa-docs/others/charles.html#android使用步骤" class="sidebar-link">Android使用步骤</a></li><li class="sidebar-sub-header"><a href="/qa-docs/others/charles.html#设置黑名单" class="sidebar-link">设置黑名单</a></li><li class="sidebar-sub-header"><a href="/qa-docs/others/charles.html#设置断点" class="sidebar-link">设置断点</a></li><li class="sidebar-sub-header"><a href="/qa-docs/others/charles.html#设置网速" class="sidebar-link">设置网速</a></li><li class="sidebar-sub-header"><a href="/qa-docs/others/charles.html#压测-重复发送请求" class="sidebar-link">压测/重复发送请求</a></li></ul></li><li><a href="/qa-docs/others/jenkins.html" class="sidebar-link">持续集成工具Jenkins</a></li><li><a href="/qa-docs/others/http-request.html" class="sidebar-link">HTTP网络协议</a></li><li><a href="/qa-docs/others/attention-point.html" class="sidebar-link">测试注意点</a></li><li><a href="/qa-docs/others/automation-framework.html" class="sidebar-link">自动化测试框架基本原理</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>测试基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>代码学习</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux学习</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>读书笔记</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="charles-抓包"><a href="#charles-抓包" class="header-anchor">#</a> Charles 抓包</h1> <h2 id="简介"><a href="#简介" class="header-anchor">#</a> 简介</h2> <p>Charles是一款代理服务器，通过成功电脑或者浏览器的代理，然后截取请求和请求结果分析数据的目的。</p> <p>在测试过程中，<strong>经常使用该抓包工具达到以下目的</strong>：</p> <ol><li>获取数据分析缺陷的来源</li> <li><strong>模拟网络请求</strong>：可选择已有的网络速度，也可手动编辑网速</li> <li>模拟request请求数据、模拟response响应数据</li> <li>黑名单：模拟请求超时、模拟请求返回404等</li></ol> <h2 id="mscos下载安装-charles"><a href="#mscos下载安装-charles" class="header-anchor">#</a> mscOS下载安装 Charles</h2> <ol><li>Charles官网下载安装包，下载成功后根据提示安装即可。
<a href="https://www.charlesproxy.com/download/" target="_blank" rel="noopener noreferrer">官方网站<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ol> <p><img src="/qa-docs/assets/img/install-charles.d527609e.png" alt="安装Charles"></p> <ol start="2"><li>激活Charles</li></ol> <p>Charles激活码:</p> <p>Registered Name: https://zhile.io</p> <p>License Key: 48891cf209c6d32bf4</p> <p>激活步骤：
打开Charles，help-&gt;Registered to xclient - Multi-Site License，输入账号和key提交破解成功就可以使用了</p> <h2 id="http代理设置"><a href="#http代理设置" class="header-anchor">#</a> HTTP代理设置</h2> <ol><li>设置PC端代理端口号
在Proxy——&gt;Proxying Settings——&gt;点击add——&gt;在弹出的对话框里面设置端口号：8888（也可更改，手机设置代理输入一致即可）,最后如图所示：</li></ol> <p><img src="/qa-docs/assets/img/http-config.42be34c2.png" alt="设置PC端口号"></p> <h2 id="https代理配置"><a href="#https代理配置" class="header-anchor">#</a> HTTPS代理配置</h2> <ol><li>配置SSL访问
在Proxy——&gt;SSL Proxying Settings——&gt;点击add——&gt;在弹出的对话框里面设置主机host:*和端口号post:443——&gt;勾选Enable SSL Proxying,最后如图所示：</li></ol> <p><img src="/qa-docs/assets/img/ssl-config.256b2c5b.png" alt="配置SSL访问"></p> <h2 id="ios使用步骤"><a href="#ios使用步骤" class="header-anchor">#</a> iOS使用步骤</h2> <ol><li>打开charles后，要安装SSL证书：help——&gt;SSL proxying——&gt;Install Charles Root Certificate On a Mobile Device or Remote Browser，最后出现如图所示弹框：</li></ol> <p><img src="/qa-docs/assets/img/install-ssl.8a40fa33.png" alt="安装SSL证书"></p> <ol start="2"><li>iOS端手机可根据第二步的弹窗更改手机端的设置：即点开wifi旁边的感叹号——&gt;点击配置代理——&gt;选择手动——&gt;填入服务器号，即本机IP地址，端口号：8888（一般默认8888）——&gt;点击存储——&gt;再在safari浏览器网址栏输chls.pro/ssl——&gt;点击安装，最后证书状态显示已验证如图所示：</li></ol> <img src="/qa-docs/assets/img/ssl-status.075bee44.png" width="30%"> <ol start="3"><li>继续iOS手机端设置：通用——&gt;关于本机——&gt;证书信任设置——&gt;选择信任刚刚下载的SSL证书，最后如图所示：</li></ol> <p>[注]：手机和电脑必须处在同一个局域网内，也就是必须连接同一个wife</p> <img src="/qa-docs/assets/img/ssl-trust.cbb37f8c.png" width="30%"> <h2 id="android使用步骤"><a href="#android使用步骤" class="header-anchor">#</a> Android使用步骤</h2> <ol><li>打开charles后，要安装SSL证书：help——&gt;SSL proxying——&gt;Install Charles Root Certificate On a Mobile Device or Remote Browser，最后出现如图所示弹框：</li></ol> <p><img src="/qa-docs/assets/img/install-ssl.8a40fa33.png" alt="安装SSL证书"></p> <ol start="2"><li>设置-WLAN，进入已连接WiFi手动设置（端口需与PC端设置端口号一致）</li></ol> <p>[注]不同安卓手机弹出设置代理入口不同，如果进入网络详情页无代理项，可在WLAN列表长按wifi名称弹出代理设置</p> <img src="/qa-docs/assets/img/android-config.d6031113.jpg" width="30%"> <ol start="3"><li>在浏览器网址栏输chls.pro/ssl——&gt;证书下载成功后，进入设置-更多设置-系统安全-从存储的设备安装页面，查看已下载的证书，选择证书安装，输入证书名称，证书命名可随意填写，确定后安装成功！如图所示：</li></ol> <p>[注]：手机和电脑必须处在同一个局域网内，也就是必须连接同一个wife</p> <img src="/qa-docs/assets/img/ssl-down.9cd27a4e.png" width="30%"> <h2 id="设置黑名单"><a href="#设置黑名单" class="header-anchor">#</a> 设置黑名单</h2> <ol><li><p>选择需要加入黑名单的请求，鼠标点击右键--选择black list即添加成功</p></li> <li><p>查看和修改已加入黑名单的请求：菜单路径tools-black list；一般测试过程中用来模拟请求超时(Drop conneciton)或者返回403(Return 403 response)</p></li></ol> <img src="/qa-docs/assets/img/black-list-drop.9759096a.png" width="30%"> <img src="/qa-docs/assets/img/black-list-403.aa78cc85.png" width="30%"> <p>[注]：双击请求，将query删除</p> <img src="/qa-docs/assets/img/del-query.5919ab4b.png" width="30%"> <p>当黑名单添加成功后，对其进行抓取，如图</p> <p><img src="/qa-docs/assets/img/add-success.9a3e73bc.png" alt="添加黑名单"></p> <p>将黑名单去除后，对其进行抓取，为200，如图</p> <p><img src="/qa-docs/assets/img/remove-list.49555f59.png" alt="去除黑名单"></p> <h2 id="设置断点"><a href="#设置断点" class="header-anchor">#</a> 设置断点</h2> <p>设置断点，可以修改请求的request数据，也可以修改response响应数据。</p> <p>目前使用fiddler发现设置断点，该工具有的返回格式不是json，导致客户端不会展示。使用Charles工具，可以避免该问题，具体操作如下</p> <ol><li>对要打断点的接口右键，选择「Breakpoints」，添加到断点列表后，进入proxy-Breakpoints settings(手动编辑断点内容)设置断点的类型</li></ol> <p>断点类型分为：request断点、response断点</p> <img src="/qa-docs/assets/img/breakpoints-settings.e2fa86e3.png" width="30%"> <ol start="2"><li><p>双击Location中的想要打断点的接口，弹出Edit Breakpoints</p></li> <li><p>将Query中的内容删除，输入*</p></li></ol> <p>如果修改Request数据，就将Request勾选</p> <p>如果修改Response数据，就将Response勾选</p> <img src="/qa-docs/assets/img/edit-breakpoint.996c301f.png" width="30%"> <ol start="4"><li>此时重新访问该接口，Charles自动跳转到Breakpoints页面</li></ol> <img src="/qa-docs/assets/img/breakpoint-page.806ff185.png" width="30%"> <ol start="5"><li>此时修改Response数据，点击Edit Response，切换底部tab至JSON，修改所需要的数据</li></ol> <img src="/qa-docs/assets/img/edit-response.bf7ab076.png" width="100%"> <ol start="6"><li><p>修改数据后，点击Execute，查看访问的页面，数据将会显示已修改的Response数据</p></li> <li><p>自动将指定的响应(response)数据改为固定返回值</p></li></ol> <p>1）选择该网络请求-&gt;鼠标右键Save Response...</p> <p>2）如果该请求返回一个json串，保存文件时需要保存21006.json</p> <p>3）需要更改请求，点击右键Map Local...指定到本地保存的21006.json</p> <img src="/qa-docs/assets/img/edit-mapping-response.db6683e6.png" width="30%"> <p>4）通过在本地更改21006.json就可以自动更改请求的返回值。避免每次使用时修改breakpoints中的返回值，提高效率</p> <ol start="8"><li>自动将制定的请求(request)数据改为固定返回值</li></ol> <p>1）选择该网络请求-&gt;鼠标右键Map Remove...，请求添加成功后</p> <p>2）将编辑好的响应数据填充在编辑框的下半部分，如下图</p> <img src="/qa-docs/assets/img/edit-mapping-request.e467d70b.png" width="30%"> <p>按上诉操作成功后，再次发起该请求，会自动使用已设置好的请求数据</p> <h2 id="设置网速"><a href="#设置网速" class="header-anchor">#</a> 设置网速</h2> <p>菜单路径：proxy-throttle settings ，勾选enable throttling 启动限速</p> <img src="/qa-docs/assets/img/throttle-setting.94e6e38f.png" width="30%"> <p>根据以上设置成功后，接下来测试过程中发起的请求都会在该网络下运行。该功能主要用在模拟不同网速下的请求场景，例如：模拟弱网请求</p> <h2 id="压测-重复发送请求"><a href="#压测-重复发送请求" class="header-anchor">#</a> 压测/重复发送请求</h2> <p>菜单路径：tools-Advanced Repeat...，也可以在控制台上选择某个请求，然后鼠标右键打开菜单，选择Repeat advance...，打开Repeat advance的设置窗口如下：</p> <img src="/qa-docs/assets/img/advanced-repeat.a0f1aef7.png" width="30%"> <ol><li>Iterations：重复次数</li> <li>Consurrency：并发</li> <li>Repeat delay(ms)：重复延迟间隔</li></ol> <p>设置重复参数后，点击OK会打开新的session进行压力测试，压力测试结果如下</p> <img src="/qa-docs/assets/img/session.f4f0cb00.png" width="100%"></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次编辑时间:</span> <span class="time">2020/6/30 上午8:20:08</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/qa-docs/others/redis.html" class="prev">
        Redis入门
      </a></span> <span class="next"><a href="/qa-docs/others/jenkins.html">
        持续集成工具Jenkins
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/qa-docs/assets/js/app.b6b34311.js" defer></script><script src="/qa-docs/assets/js/3.d8df636e.js" defer></script><script src="/qa-docs/assets/js/4.7d1b1b70.js" defer></script>
  </body>
</html>
